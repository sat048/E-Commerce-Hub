import React, { useEffect, useState, useContext, useRef } from 'react'
import "../App.css"
import axios from "axios"
import Context from "../utils/context.js";
import { Card, WingBlank, WhiteSpace, Button } from 'antd-mobile';
import Bscroll from "better-scroll";



export default function Index(props) {
    // let {searchlist} = useContext(Context);

    let [list, setList] = useState([]);
    let [box, setbox] = useState(false);
    let [ids, setid] = useState(0);
    const index = useRef(null);
    // console.log(iptValue);
    //模糊搜索
    //  Change = async ()=>{
    //     console.log(iptValue);
    //  
    // 
    // setList(searchlist)
    useEffect(async () => {
        //渲染页面
        let res = await axios.post("/api/list");
        setList(res.data.data)
        //better-scroll
        new Bscroll(index.current, { click: true });
        // document.querySelector(".index")
    }, [])
    //删除功能
    const Del = async (item) => {
        let res = await axios.get("/api/del", { params: { id: item.id } });
        setList(res.data.data)
    }
    //复选框
    const Changebox = async (id) => {
        let res = await axios.get("/api/check", { params: { id: id } });
        setList(res.data.data)
    }
    //全选反选
    const Changechecked = async () => {
        setbox(!box)
        let res = await axios.get("/api/checked", { params: { box: !box } })
        setList(res.data.data);
    }

    //跳转详情
    const Todetail = (id) => {
        props.history.push(`/detail/${id}`);

    }
    //添加购物车
    const Tocar = (item) => {
        setid(item.id)
        if (item.bollean) {
            props.history.push(`/app/carlist/${ids}`);
        } else {
            alert("您还没有选择")
        }

    }

    return (
        <div className="index" ref={index} >
            <div className="indcon">
                <input type="checkbox" checked={box} onChange={() => Changechecked()} /><span>全选</span>
                {
                    list.length && list.map((item, index) => {
                        return <WingBlank size="lg" key={index} >
                            <WhiteSpace size="lg" />
                            <Card>
                                <Card.Header
                                    title={item.title}
                                    thumb={item.img}
                                    onClick={() => Todetail(item.id)}
                                />
                                <Card.Body>
                                    <div> {item.info} </div>
                                </Card.Body>
                                <Card.Footer extra={<div> <Button type="warning" size="small" inline="true" onClick={() => Del(item)} >删除</Button><Button type="warning" size="small" inline="true" onClick={() => Tocar(item)} >添加购物车</Button><WhiteSpace /></div>} />
                                <input type="checkbox" checked={item.bollean} onChange={() => Changebox(item.id)} />
                            </Card>
                            <WhiteSpace size="full" />
                        </WingBlank>
                    })
                }
            </div>
        </div>
    )
}